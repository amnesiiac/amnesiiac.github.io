---
layout: post
title: "cpp - header files"
subtitle: '头文件相关知识整理'
author: "twistfatezz"
header-style: text
# header-img: "img/in-post/economics_1/headimg.png"
# header-mask: 0.8
comments: false 
mathjax: true
date: 2021-05-07 14:35
lang: ch 
catalog: true 
categories: cpp 
tags:
  - Time 2021
  - cpp fundermentals
---
### header files简述
头文件为所有的extern对象声明，函数声明以及inline函数的定义提供了一个集中的位置，称之为声明的局部化。一个文件想要使用或者定义一个对象或者函数时，必须包含相应的头文件。

头文件提供了两类安全保证：**第一** 保证所有文件都包含同一个全局对象或者函数的同一份声明。**第二** 方便修改对象或者函数的声明，只需要修改头文件中的声明，即可应用到所有包含这个头文件的文件中。

但是如果头文件太大，或者头文件中对象和函数在工程中的\<作用域\>太过分散，从而导致编译时间开销很大；为了能够减少编译时间开销，可以使用预编译头文件代替不同头文件，很大程度上可以减少应用程序编译时间。

### header file编写注意事项
`1` 头文件主要包括extern对象声明、函数声明、inline函数的定义。 <br>
`2` 头文件提供的声明从业务逻辑上应当属于一个组，即保证同一头文件声明的对象从业务逻辑上不应该太分散。<br>
`3` 为了减少头文件编译时间，可以考虑创建预编译头文件代替普通头文件。<br>
`4` 头文件中只有符号常量、inline函数定义。头文件出现符号常量是利用了编译器的常量折叠(const folding)特性，符号常量可以在同一程序不同文件中被定义多次，以实现在使用时，其定义对编译器可见(进行常量替换)。某些情况下，编译器无法做到常量折叠，可以使用如下方式完成定义(通过extern关键字声明，在源文件定义):
```c++
// -- header file --
const int buf_size=1024;
extern int * const buf_ptr;// 指针常量声明 无法在编译时进行初始化 无法调用new
// -- source file --
buf_ptr=new char[buf_size];// 只能在源文件中定义 在运行时初始化
```
`5` 非常量变量如果在一个头文件中被定义，被整个工程中的两个不相关(分别属于不同编译单元)的源文件同时包含，则导致链接错误。本质上就是：**具有外部链接性的变量在不同编译单元中只能有一个定义**。即：非常量变量(外部链接性变量)的定义在不同编译单元中多处被包含(定义)，会引发链接错误。关于外部链接性和内部链接性详见[博客](/cpp/2021/05/06/post-cpp-linkage/)。
```c++
const char * buf_name="xxx";// buf_name不是一个常量 -> 具有外部链接性
const char * const new_buf_name="xxx";// 指针常量 -> 具有内部链接性
```
`6` 头文件中添加inline函数定义时，需谨慎，尽量在必要的时候才使用inline定义，能够有效减少头文件臃肿；慎重的检查函数是否符合定义成inline函数资质。关于inline函数的内容详见[博客](/cpp/2021/04/16/post-cpp-inline/)。

## Reference
> 《c++ primer》p333

> 1 当使用inline数学公式且公式经过GFM排版之后都在同一行 使用`$...$`符号<br>
> 2 当希望数学公式单独成行或者经过GFM排版之后占用多行 应当使用`$$...$$`符号<br>
> 3 对于表示条件概率 需要表示竖线的时候`|` 应当使用`\mid` 而不是直接在键盘上打出`|` => 容易被编辑器认为是一个md制表符<br>
> 4 在md引入图片的时候 不要使用`<center>`和`</center>` 在这篇文档的编辑过程中vscode的preview插件在使用了上述符号之后 导致下一段的数学公式预览显示不正常<br>
> 5 使用md的时候 单独的两段文字上下需要空出一行<br>
> 6 想要强制换行的时候 需要使用`<br>`而不是`<enter>`<br>
> 7 特殊字符如果想要避免和md解析关键字冲突 应当使用``将关键字包含在内
