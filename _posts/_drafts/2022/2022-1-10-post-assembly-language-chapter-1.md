---
layout: post
title: "assembly language (基础知识)"
subtitle: '[assembly language wangshuang 3ed] - chapter1' 
author: "twistfatezz"
header-style: text
# header-img: "img/in-post/economics_1/headimg.png"
# header-mask: 0.8
comments: false 
mathjax: false 
date: 2022-01-10 13:53
lang: ch 
catalog: true 
categories: assembly
tags:
  - Time 2022
---
### 本文简介
汇编语言是直接在硬件上工作的语言，首先需要对硬件系统结构进行了解，才能有效地应用汇编语言对其进行编程。因此，本文先对硬件系统结构进行介绍，以此为基础介绍汇编语言相关知识。

本系列对汇编语言知识的整理过程不会对硬件系统进行全面、深入的研究；关于PC和CPU的物理结构、编程结构相关知识在❮微机原理与接口❯中介绍；关于计算机通用结构、功能、性能的知识在❮计算机组成原理❯中介绍。

汇编课程的研究重点在于：如何利用硬件系统的编程结构、指令集有效灵活的控制系统完成所需工作。


### 一：机器语言
机器语言是机器指令的集合。对于电子计算机而言，它的机器指令为一列2进制数字；计算机将其转化成一列高低电平，从而驱动计算机电子器件进行运算。

现代PC机有一个能够完成上述功能的芯片：CPU(central processing unit，中央处理器)。CPU是一种微处理器，后续提到的计算机系统由CPU及其他受CPU直接、间接控制的芯片、器件、设备组成。
由于每种微处理器的硬件设计、内部结构不同，需要不同的电磁脉冲使它进行工作。每种微处理器都有各自的机器指令集。

早期程序设计使用机器语言，程序员将0、1数字编成的代码打在纸带、卡片上，1打孔、0不打孔，在将程序通过纸带机、卡片机输入计算机。
<center><img src="/img/in-post/assembly_language_img/chapter_1_1.pdf" width="100%"></center>

书写、阅读机器码程序不是一件简单的工作，机器码存在晦涩难懂、不易差错的缺点。这是促使汇编语言产生的原因。


### 二：汇编语言
汇编语言的主体是汇编指令。汇编指令和机器指令的差别在于指令的表示方式上：汇编指令是机器指令的一种便于理解书写格式。参考下面的例子进行理解：<br>
下面的机器指令表示把寄存器BX的内容送入寄存器AX中：
```txt
1000100111011000
```
使用汇编指令写成如下形式，这种写法和人类语言相近，便于阅读、记忆：
```txt
mov ax,bx
```
然而，计算机只能理解机器指令，如何让计算机执行汇编指令编写的程序呢？需要有一个能将汇编指令转化成机器指令的翻译程序，即编译器。
<center><img src="/img/in-post/assembly_language_img/chapter_1_2.pdf" width="100%"></center>


### 三：汇编语言的组成
汇编语言由如下3类指令构成：
- ➀ 汇编指令：机器码对应的"助记符"，每条汇编指令都有对应的机器码。
- ➁ 伪指令：没有对应的机器码，由编译器执行，计算机并不会执行。
- ➂ 其他符号：+、-、\*、/等，由编译器识别，没有对应的机器码。

汇编语言的核心是汇编指令，它决定了改程序的特性。


### 四：存储器
CPU是计算机的核心部件，它控制着计算机的运作方式。但是没有存储器为它提供指令内容、数据，CPU也无法正常工作。CPU和存储器相当于人的大脑和记忆之间的关系。要想灵活使用汇编语言编程，需要首先了解CPU如何从内存中读取信息，以及如何向内存中写入信息。


### 五：指令和数据
指令和数据是它们在应用时为它们定义的概念，在内存、磁盘上，指令和数据没有任何区别，它们都是二进制信息。CPU在工作时，将有些信息当作指令，有些信息当作数据，即CPU可以为数据赋予不同的含义。

结合一个例子进行理解，下面的信息，计算机可以将其看作数据，也可以将其看作一条汇编指令：
```txt
机器码 1000100111011000 -> 89D8H (数据)
机器码 1000100111011000 -> mov ax,bx (程序)
```


### 六：存储单元(存储器的构成单元)
存储器被划分成若干存储单元，每个存储单元从0开始编号，一个具有128个存储单元的存储器如下图所示：
<center><img src="/img/in-post/assembly_language_img/chapter_1_3.pdf" width="100%"></center>


### 七：CPU对存储器的读写
存储器可以被划分成多个存储单元，存储单元从0开始编号，这些编号可以看作存储单元在存储器中的地址。CPU在内存中读取数据前需要确定要读取哪段地址对应存储单元中的数据。另外，在一台机器上不止有存储器，因此CPU在读取数据前还需要指明要对哪个器件进行操作(是读取数据还是写入数据)。

➤ CPU进行数据读写前，需要和外部芯片进行如下3类信息的交互：
- ➀ 存储单元的地址信息(地址信息 - 对应CPU地址总线)。
- ➁ 器件的选择，以及是读取数据还是写入数据(控制信息 - 对应CPU控制总线)。
- ➂ 需要被读取或写入的数据本身(数据信息 - 对应CPU数据总线)。

CPU通过总线将地址、控制、数据三种信息传输到需要操作的芯片中。从物理上讲，总线是一根根导线的集合；根据用途的不同，总线又可以分成3类：地址总线、控制总线、数据总线。

➤ CPU从特定地址(存储编号)读取数据的过程如下所示：
<center><img src="/img/in-post/assembly_language_img/chapter_1_4.pdf" width="70%"></center>
- ➀ CPU通过地址总线将地址信息"3"发出。
- ➁ CPU通过控制总线发出内存读取命令，选中存储器芯片，并通知它将从中读取数据。
- ➂ 存储器通过数据总线将3号地址中的数据"08"通过数据线送入CPU。

➤ CPU从特定地址(存储编号)写入数据的过程如下所示(写操作和读操作流程类似)：
- ➀ CPU通过地址总线将地址信息"3"发出。
- ➁ CPU通过控制总线发出内存写入命令，选中存储器芯片，并通知它将向它写入数据。
- ➂ CPU通过数据总线将数据"08"写入指定芯片的3号存储单元中。

➤ 如何通过汇编指令让CPU完成上述读写操作？<br>
为了让计算机、微处理器按照指定的方式工作，需要向它输入驱动它完成相应工作的电平信息(机器码)。<br>
对于8086CPU，下面的机器指令能够让其读取位于3号存储单元的数据：
```txt
机器码：101000010000001100000000
机器码含义：从3号存储单元读取数据送入寄存器AX
```
容易发现机器码难以理解，使用对应汇编指令的方式进行替换：
```txt
机器码：10100001 00000011 00000000
对应的汇编指令：MOV AX,[3]
汇编指令的含义：传送3号地址单元的内容到寄存器AX
```


### 八：地址总线
CPU通过地址总线来指定操作哪个存储单元，地址总线的宽度决定了可以同时传递的地址信息位数，CPU就可以实现对多少存储单元的寻址。

假设CPU有10根地址总线，1根地址总线可以传送的稳定状态有2种：高电平(1)、低电平(0)。因此10根地址总线可以表示10位2进制数据，即最小数0、最大数2^10-1。一个CPU有N根地址总线，则可以称这个CPU的地址总线宽度为N，这样的CPU最多可查询2^N个存储单元。

下图展示了具有10根地址总线的CPU向内存中发送10bit地址信息，以操作特定存储单元数据示意图。
<center><img src="/img/in-post/assembly_language_img/chapter_1_5.pdf" width="70%"></center>


### 九：数据总线
CPU和其他芯片之间的数据传输是通过数据总线来完成的，数据总线的宽度决定了CPU和外部芯片之间数据传输的速度：8根数据总线一次可以传输8bit二进制数据(1byte)，16根数据总线一次可以传输16bit二进制数据(2byte)。

下图展示了8088CPU和8086CPU在向内存中写入数据89D8H时，是如何通过数据总线传输数据的。
<center><img src="/img/in-post/assembly_language_img/chapter_1_6.pdf" width="100%"></center>
可以看出：8086CPU拥有16根数据总线，可以一次传输16bit数据信息，因此可以一次完成89D8H数据传输，而8088CPU只有8根总线，需要两次完成89D8H数据传输。 


### 十：控制总线
CPU通过控制总线完成对外部芯片的控制。不同于数据总线和地址总线，这里的控制总线表示一些不同的控制线的集合。集合中有多少根控制总线，就意味着CPU支持对外部芯片的多少种控制。因此控制总线的宽度决定了CPU对于外部设备的控制能力。

本文前面提到的CPU对内存的读写命令是由几根控制总线综合发出的，其中"读信号输出"控制线负责CPU向外部传输读取信号；"写信号输出"控制线负责CPU向外部传输写信号。


### 十一：内存地址空间(概述)
内存地址空间是什么？举例说明：一个CPU地址总线的宽度为10，那么可以寻址1024个存储单元，则这1024个可以寻址的存储单元就构成了该CPU的内存地址空间。关于CPU的地址空间相关内容，在后续部分进一步进行介绍。


### 十二：主板
每台计算机上，都有一个主板，主板上包含核心芯片、主要器件，这些器件通过3总线相连。这些器件包含：CPU、存储器、外围芯片组、扩展插槽等；拓展插槽上插有RAM内存条、各类接口卡(用于CPU间接管理外部设备)。


### 十三：接口卡
计算机系统中，所有支持程序控制下工作的，都必须受CPU的控制。CPU只能间接控制这些外部设备e.g. 显示器、音响、打印机...)，直接控制这些外部设备的是插在与CPU相连的拓展卡槽上的接口卡。CPU通过直接控制这些接口卡来实现对外部设备的控制：CPU通过总线向接口卡发送命令，接口卡根据CPU的命令控制外部设备进行工作。

### 十四：各类存储芯片
计算机中，装有多个存储器芯片，从物理上它们之间相互独立。这些存储器芯片从❮读写属性❯上可以分成2类：随机存储器(random-access memory, RAM)，只读存储器(read-only memory, ROM)。随机存储器可读可写，但必须带电存储，断电后存储内容消失；只读存储器只能读取不能写入，断电后内容不会丢失。

➤ 下图展示了计算机系统中各类存储器之间的逻辑连接情况：
<center><img src="/img/in-post/assembly_language_img/chapter_1_7.pdf" width="80%"></center>
- ➀ **随机存储器(RAM)用于存放供CPU调用的主要的程序、数据部分** 主随机存储器一般由两个位置上的RAM组成：装在主板上的RAM、装在拓展插槽上的RAM。
- ➁ **装有BIOS(basic input/output system)的只读存储器(ROM)** BIOS是由主板、各类接口卡(显卡、网卡...)的厂商提供的软件系统。在主板、接口卡上插有存储相应BIOS软件的ROM。
- ➂ **接口卡上的随机存储器(RAM)** 某些接口卡需要对大批量输入的数据进行暂存，接口卡上的RAM芯片负责保存这些数据。例如：显卡上的显存就是用于暂存显示数据的RAM；向显卡中的显存RAM写入数据，这些数据将会显示在显示器上。


### 十五：内存地址空间
上一小节提到的各类存储器(CPU的外部设备)，在物理上是独立的器件，但是却有如下2点共性：
- ➀ 都和CPU通过总线相连。
- ➁ CPU对这些存储器进行读写的时候都通过控制总线发出的内存读写命令来完成。

通过上述2点共性可以看出：CPU在操作外部设备时，将它们抽象成计算机的内存，将所有外部设备的集合看成是若干存储单元构成的逻辑存储器，这个抽象成的存储单元的集合就是所谓的"内存地址空间"。在汇编原理中，所操作的对象就是"内存地址空间"。

➤ 下图展示了计算机中的CPU对于各类存储器的抽象：物理存储设备和逻辑上的"内存地址空间"之间的对应关系：
<center><img src="/img/in-post/assembly_language_img/chapter_1_8.pdf" width="90%"></center>
所有物理存储器都被CPU看作是由若干存储单元组成的逻辑存储器，即每个物理上的存储器都被映射成了逻辑上的一段地址段；CPU通过向特定地址段读写数据来实现向物理存储器中读写数据。

➤ ❮假设❯上图中逻辑地址空间中每段地址分配如下图所示，分别向3个逻辑地址写入数据，得到的结果分析如下图：
<center><img src="/img/in-post/assembly_language_img/chapter_1_9.pdf" width="90%"></center>

➤ 内存地址空间的大小受CPU地址总线宽度的限制 <br>
8086CPU的地址总线宽度为20，因此传输的单个地址可以覆盖2^20个不同地址信息(从0到2^20-1)，即可以定位2^20个存储单元；因此8086CPU的内存地址空间大小为1MB。同理，80386CPU的地址总线宽度为32，则内存地址空间大小为4GB。

因此，在基于计算机硬件进行系统编程时，必须知道该系统中内存地址空间的分配情况(首存储单元地址、尾存储单元地址)。下图展示了8086计算机内存地址分配情况：
<center><img src="/img/in-post/assembly_language_img/chapter_1_10.pdf" width="60%"></center>

➤ 关于内存地址空间的补充说明 <br>
最终执行汇编程序(翻译成机器指令)的是CPU，因此在使用汇编程序编程时，❮必须要从CPU角度考虑问题❯。对于CPU来说，物理上各自独立的外部设备映射成的逻辑存储单元都处于同一逻辑存储器中(内存地址空间)，该逻辑存储器的容量收到CPU寻址能力的限制。




## Reference
> \<assembly language by wangshuang 3ed\> chapter1 <br>

> 1 当使用inline数学公式且公式经过GFM排版之后都在同一行 使用`$...$`符号<br>
> 2 当希望数学公式单独成行或者经过GFM排版之后占用多行 应当使用`$$...$$`符号<br>
> 3 对于表示条件概率 需要表示竖线的时候`|` 应当使用`\mid` 而不是直接在键盘上打出`|` => 容易被编辑器认为是一个md制表符<br>
> 4 在md引入图片的时候 不要使用`<center>`和`</center>` 在这篇文档的编辑过程中vscode的preview插件在使用了上述符号之后 导致下一段的数学公式预览显示不正常<br>
> 5 使用md的时候 单独的两段文字上下需要空出一行<br>
> 6 想要强制换行的时候 需要使用`<br>`而不是`<enter>`<br>
> 7 特殊字符如果想要避免和md解析关键字冲突 应当使用\`\`将关键字包含在内 <br>
> 8 `<center><img src="/img/in-post/economics_4/xxx.png" width="60%"></center>` <br>
> 9 使用html设置图片文字环绕方式: <br>
    `<div>` <br>
        `<img src="/img_path" align="left" width="40%" hspace="" vspace=""/>` <br>
        `<p>paragraph1 around the picture</p>` <br>
        `<p>paragraph2 around the picture</p>` <br>
        `<p>paragraph3 around the picture</p>` <br>
    `</div>` <br>
> 10 `<font style="color:red; font-weight:bold">加粗蓝色</font>`用来设置字体颜色 <br>
> 问题脚注: ### ???problem😫problem???
